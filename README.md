# GitHub Actions Terraform Cloud Configuration

This README provides an overview of the Terraform configuration for automating infrastructure management using GitHub Actions and Terraform Cloud. It outlines the steps to set up and use the GitHub Actions workflows for Terraform Plan and Terraform Apply.

## Setup

### Terraform Cloud Setup
1. **Create an Account**: If you don't already have one, sign up for a Terraform Cloud account at [Terraform Cloud](https://app.terraform.io/).
2. **Create an Organization**: Once logged in, create a new organization or select an existing one.
3. **Create a Workspace**: Inside your organization, create a new workspace that will be connected to your GitHub repository.
4. **Generate API Token**: 
   - Go to "User Settings" in Terraform Cloud.
   - Navigate to "Tokens" and create a new API token.
   - Save this token securely as it will be used in GitHub Actions.

### GitHub Setup
1. **Add Secrets to GitHub Repository**: 
   - Navigate to your GitHub repository.
   - Go to 'Settings' > 'Secrets'.
   - Add the following secrets:
     - `TF_API_TOKEN`: The Terraform Cloud API token you generated.
     - `GITHUB_TOKEN`: A GitHub token for repository access (usually auto-generated by GitHub Actions).
2. **Update Workflow Files**: 
   - Edit the provided GitHub Actions workflow files to match your setup.
   - Replace `My-TFC-Tutorial` with your Terraform Cloud organization name.
   - Replace `github_actions_tfc` with your Terraform Cloud workspace name.
   - Adjust `CONFIG_DIRECTORY` if your Terraform configurations are in a different directory.

## Workflow

### Terraform Plan Workflow
- **Trigger**: The workflow is triggered on pull requests to the `master` and `prod` branches.
- **Steps**:
  1. **Checkout**: Checks out the repository code.
  2. **Upload Configuration**: Uploads the Terraform configuration to Terraform Cloud.
  3. **Create Plan Run**: Creates a speculative plan in Terraform Cloud.
  4. **Get Plan Output**: Retrieves the output of the Terraform plan.
  5. **Update PR**: Posts the plan output as a comment in the pull request.

### Terraform Apply Workflow
- **Trigger**: The workflow is triggered on pull requests to the `prod` branch.
- **Steps**:
  1. **Checkout**: Checks out the repository code.
  2. **Upload Configuration**: Uploads the Terraform configuration to Terraform Cloud.
  3. **Create Apply Run**: Creates an apply run in Terraform Cloud.
  4. **Apply**: Applies the Terraform configuration if it is confirmable.

## Additional Information
- **Terraform Configuration**: The provided Terraform configuration manages Google Cloud resources such as compute instances and project services.
- **Version Control**: The `updates` block in the configuration ensures that the
<!--
GitHub Actions and the Terraform CLI are kept up-to-date.
- **Provider Requirements**: The configuration specifies version requirements for the Google Cloud and Random providers.

### Tips and Best Practices
- **Review Pull Requests Carefully**: Changes in infrastructure as code should be reviewed with the same rigor as application code.
- **Regularly Update Dependencies**: Keep your Terraform providers and modules updated to benefit from the latest features and fixes.
- **Secure Your Secrets**: Always store sensitive information like API tokens as encrypted secrets in GitHub or Terraform Cloud.
- **Understand Terraform Workflow**: Familiarize yourself with Terraform's core concepts like state management, workspaces, and plans/applies.

## Troubleshooting
- **Workflow Failures**: Check the GitHub Actions logs for specific error messages.
- **Terraform Cloud Issues**: Look at the Terraform Cloud run logs for detailed Terraform execution errors.
- **Connectivity Problems**: Ensure your GitHub repository can connect to Terraform Cloud and that your API tokens are valid.

## Additional Resources
- [Terraform Cloud Documentation](https://www.terraform.io/cloud-docs)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Automate Terraform with GitHub Actions Tutorial](https://developer.hashicorp.com/terraform/tutorials/automation/github-actions)

This README provides a starting point for using GitHub Actions with Terraform Cloud. Adapt and expand upon it as needed for your specific infrastructure management requirements.

# GitHub Actions Terraform Configuration README

This README provides an overview of the Terraform configuration for automating infrastructure management using GitHub Actions and Terraform Cloud. It outlines the steps to set up and use the GitHub Actions workflows for Terraform Plan and Terraform Apply.

## Setup

### Terraform Cloud Setup
1. **Create an Account**: If you don't already have one, sign up for a Terraform Cloud account at [Terraform Cloud](https://app.terraform.io/).
2. **Create an Organization**: Once logged in, create a new organization or select an existing one.
3. **Create a Workspace**: Inside your organization, create a new workspace that will be connected to your GitHub repository.
4. **Generate API Token**: 
   - Go to "User Settings" in Terraform Cloud.
   - Navigate to "Tokens" and create a new API token.
   - Save this token securely as it will be used in GitHub Actions.

### GitHub Setup
1. **Add Secrets to GitHub Repository**: 
   - Navigate to your GitHub repository.
   - Go to 'Settings' > 'Secrets'.
   - Add the following secrets:
     - `TF_API_TOKEN`: The Terraform Cloud API token you generated.
     - `GITHUB_TOKEN`: A GitHub token for repository access (usually auto-generated by GitHub Actions).
2. **Update Workflow Files**: 
   - Edit the provided GitHub Actions workflow files to match your setup.
   - Replace `My-TFC-Tutorial` with your Terraform Cloud organization name.
   - Replace `github_actions_tfc` with your Terraform Cloud workspace name.
   - Adjust `CONFIG_DIRECTORY` if your Terraform configurations are in a different directory.

## Workflow

### Terraform Plan Workflow
- **Trigger**: The workflow is triggered on pull requests to the `master` and `prod` branches.
- **Steps**:
  1. **Checkout**: Checks out the repository code.
  2. **Upload Configuration**: Uploads the Terraform configuration to Terraform Cloud.
  3. **Create Plan Run**: Creates a speculative plan in Terraform Cloud.
  4. **Get Plan Output**: Retrieves the output of the Terraform plan.
  5. **Update PR**: Posts the plan output as a comment in the pull request.

### Terraform Apply Workflow
- **Trigger**: The workflow is triggered on pull requests to the `prod` branch.
- **Steps**:
  1. **Checkout**: Checks out the repository code.
  2. **Upload Configuration**: Uploads the Terraform configuration to Terraform Cloud.
  3. **Create Apply Run**: Creates an apply run in Terraform Cloud.
  4. **Apply**: Applies the Terraform configuration if it is confirmable.

## Additional Information
- **Terraform Configuration**: The provided Terraform configuration manages Google Cloud resources such as compute instances and project services.
- **Version Control**: The `updates` block in the configuration ensures that the
<!--
GitHub Actions and the Terraform CLI are kept up-to-date.
- **Provider Requirements**: The configuration specifies version requirements for the Google Cloud and Random providers.

### Tips and Best Practices
- **Review Pull Requests Carefully**: Changes in infrastructure as code should be reviewed with the same rigor as application code.
- **Regularly Update Dependencies**: Keep your Terraform providers and modules updated to benefit from the latest features and fixes.
- **Secure Your Secrets**: Always store sensitive information like API tokens as encrypted secrets in GitHub or Terraform Cloud.
- **Understand Terraform Workflow**: Familiarize yourself with Terraform's core concepts like state management, workspaces, and plans/applies.

## Troubleshooting
- **Workflow Failures**: Check the GitHub Actions logs for specific error messages.
- **Terraform Cloud Issues**: Look at the Terraform Cloud run logs for detailed Terraform execution errors.
- **Connectivity Problems**: Ensure your GitHub repository can connect to Terraform Cloud and that your API tokens are valid.

## Additional Resources
- [Terraform Cloud Documentation](https://www.terraform.io/cloud-docs)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Automate Terraform with GitHub Actions Tutorial](https://developer.hashicorp.com/terraform/tutorials/automation/github-actions)

This README provides a starting point for using GitHub Actions with Terraform Cloud. Adapt and expand upon it as needed for your specific infrastructure management requirements.


This repo is a companion repo to the [Automate Terraform with GitHub Actions tutorial](https://developer.hashicorp.com/terraform/tutorials/automation/github-actions).
